!(function(){'use strict';var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if('function'!=typeof n&&null!==n)throw new TypeError('Class extends value '+n+' is not a constructor or null');function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function n(t){return void 0===t}function i(t){return null===t}function r(t){return Array.isArray(t)}function o(t){return c(t,'function')}function a(t){return c(t,'number')}function u(t){return c(t,'object')}function c(t,e){return typeof t===e}var s='redraw',l=5,d=[4,0],h=[1,2],f=[0,0],p={top:f,right:f,bottom:f,left:f};function v(t){n(t.height)&&(t.height=14)}var g=Math.floor(1048575*Math.random())<<10;function _(){return(g++).toString(36)}function m(t,e){return t.subscribe(e)}var w=function(t,e,n,i){this._id=t,this._store=e,this._callback=n,this._unsubscribe=m(e,i)};function y(t){if(!t||!u(t))return!1;var e=t;return o(e.get)&&o(e.subscribe)}function x(t){return!(!t||!u(t))&&(function(t){return!(!t||!u(t))&&y(t)&&o(t.set)})(t.twoway)}var b=(function(){function t(){this._bindings=[],this._source=null}return t.prototype.add=function(t,e,n,i){this.on(t,n,(function(t,n){var r=i?i(n):n;t[e]=r}))},t.prototype.callback=function(t,e,n,i,r){x(n)?t[e]=function(t){var e=r?r(t):t;n.twoway.set(e),i&&i(e)}:i&&(t[e]=r?function(t){return i(r(t))}:i)},t.prototype.twoway=function(t,e,n,i,r){this.add(t,e,i),this.callback(t,n,i,r)},t.prototype.on=function(t,e,i){var r=(function(t){return x(t)?t.twoway:t})(e);if(y(r)){var o=this._createBinding(t,r,i);this._bindings.push(o),i(t,r.get())}else n(r)||i(t,r)},t.prototype._unbind=function(){this._source=null},t.prototype._hasBindings=function(){return this._bindings.length>0},t})(),C=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._bind=function(t){var e=t._description;e&&this._refresh(e),this._source=t},n.prototype._createBinding=function(t,e,n){var i=this;return new w('',e,n,(function(t){var e=i._source;e&&e._window&&n(e._window,t)}))},n.prototype._refresh=function(t){var e=this._bindings;if(e)for(var n=0,i=e;n<i.length;n++){var r=i[n];r._callback(t,r._store.get())}},n})(b);function k(t,e){void 0===e&&(e={});for(var n=0,i=t;n<i.length;n++){var r=i[n],o=r.name;o&&!(o in e)&&(e[o]=r)}return e}function V(t){return z(t,0)}function A(t){return z(t,1)}function L(t){return z(t,2)}function z(t,e){return t[1]===e}function M(t){throw Error(t)}function W(t){if(n(t))return t;if(a(t))return[t,0];var e=t.trim(),i=e.length;if(i>1){var r=i-1,o=void 0,u=e[r];if('w'===u?o=2:'%'===u?o=1:i>2&&(r--,'x'===u&&'p'===e[r]&&(o=0)),!n(o))return[parseFloat(e.substring(0,r)),o]}M('Value \''+t+'\' is not a valid scale.')}function S(t,e){return W(t)||e}function F(t){return S(t,f)}function I(t,e,n,i){switch(void 0===i&&(i=0),t[1]){case 2:return(n?t[0]/n:1)*e*(100-i)*.01;case 1:return.01*t[0]*e;default:return t[0]}}var O=['y','x'],T=['height','width'],P=['top','left'],R=['bottom','right'];function G(t,e,n,i){var r=T[e],o=i[P[e]],a=i[R[e]],u=t[r]-q(n,o,a,V),c=q(n,o,a,A),s=q(n,o,a,L),l=I(n,u,s,c);return t[r]=l,E(t,e,i,u,s,c)}function E(t,e,n,i,r,o){return(function(t,e,n,i,r,o,a,u,c){var s=I(e[u],n,i,r),l=I(e[c],n,i,r);return t[o]+=s,s+t[a]+l})(t,n,i,r,o,O[e],T[e],P[e],R[e])}function q(t,e,n,i){var r=0;return i(t)&&(r+=t[0]),i(e)&&(r+=e[0]),i(n)&&(r+=n[0]),r}var B,j='inherit',D='auto',H=['minHeight','minWidth'],N=['maxHeight','maxWidth'];function U(t,e,n){if((function(t){return c(t,'string')})(n))return D;var i=n,r=i.value||n;return J(t,e,r,i.min||r,i.max||r),r}function Z(t,e,n,i,r){var o=T[e],a=i[P[e]],u=i[R[e]],c=n[o]+a[0]+u[0]+r;return V(a)&&V(u)||M('Padding for '+o+' must be absolute for auto window resize.'),J(t,e,c,c,c),c}function J(t,e,n,i,r){t[T[e]]=n,t[H[e]]=i,t[N[e]]=r}!(function(t){t[t.None=0]='None',t[t.AutoHeight=1]='AutoHeight',t[t.AutoWidth=2]='AutoWidth',t[t.RedrawNextTick=4]='RedrawNextTick',t[t.Count=8]='Count'})(B||(B={}));var K,Q,X=(function(){function t(t){var e=this,n=t.width,i=t.height,r=t.position,o=new C,a={classification:'fui-'+_(),title:'',colours:t.colours,onUpdate:function(){e._checkResizeAndRedraw(),e._invoke((function(t){return t.update()}))},onClose:function(){e._window=null,e.close()}},u=U(a,1,n),c=U(a,0,i);this._setWindowSizeAndFlags(u,c),o.add(a,'title',t.title),this._windowBinder=o._hasBindings()?o:null,this._position=r,this._description=a}return t.prototype._checkResizeAndRedraw=function(){var t=this._window,e=this._activeWidgetMap,n=this._flags;if(t&&e){if(!(4&n)){var i=t.width,r=t.height,o=2&n||this._width==i,a=1&n||this._height==r;if(o&&a)return;this._width=i,this._height=r}this._layout(t,e),this._flags&=-5}},t.prototype._createFrameRectangle=function(t,e){return void 0===e&&(e=15),{x:0,y:e,width:2&t?D:this._width,height:1&t?D:this._height-e}},t.prototype._setAutoWindowSize=function(t,e,n,i){void 0===i&&(i=p);var r=this._flags;2&r&&(this._width=Z(t,1,e,i,0)),1&r&&(this._height=Z(t,0,e,i,n))},t.prototype._setWindowSizeAndFlags=function(t,e){var n=this._flags;t==D?n|=2:(n&=-3,this._width=t),e==D?n|=1:(n&=-2,this._height=e),this._flags=n},t.prototype._open=function(t,e){this._layout(t,this._descriptionWidgetMap),(function(t,e){e&&'default'!==e&&('center'===e?(t.x=ui.width/2-t.width/2,t.y=ui.height/2-t.height/2):(t.x=e.x,t.y=e.y))})(t,this._position),e&&e._bind(this);var n=ui.openWindow(t),i=k(n.widgets);this._window=n,this._activeWidgetMap=i,this._invoke((function(t){return t.open(n,i)}))},t.prototype.open=function(){if(this._window)this.focus();else{var t=this._description,e=this._windowBinder;this._open(t,e)}},t.prototype.close=function(){this._invoke((function(t){return t.close()})),this._window&&this._window.close();var t=this._windowBinder;t&&t._unbind(),this._window=null,this._activeWidgetMap=null},t.prototype.focus=function(){this._window&&this._window.bringToFront()},t.prototype.redraw=function(){this._flags|=4},t})(),Y=function(t,e){this.position=t.parse(e),this._parent=t};function $(t){return(tt(t.width)?1:0)|(tt(t.height)?2:0)}function tt(t){return n(t)||t===D}function et(t,e,n){return!!(3&e&&nt(t,1&e,1,n)|nt(t,2&e,0,n))}function nt(t,e,n,r){var o;if(e&&!i(o=r(n))){var a=T[n],u=t[a];if(u[0]!==o||!V(u))return t[a]=[o,0],1}return 0}function it(t,e,n){return V(t)&&V(e)&&V(n)}function rt(t,e,n){void 0===n&&(n=1);var i=t[0]*n;L(t)?e._requestedWeightTotal+=i:V(t)?e._requestedPixels+=i:A(t)&&(e._requestedPercentile+=i)}function ot(t,e){var i;if(void 0===e&&(e=p),n(t))i=t;else if(r(t)){var o=t.length;if(2===o){var a=F(t[0]),c=F(t[1]);i=at(a,c,a,c)}else 4===o?i=at(F(t[0]),F(t[1]),F(t[2]),F(t[3])):M('Padding array of unknown length: '+o+'. Only lengths of 2 or 4 are supported.')}else if(u(t))i=at(S(t.top,e.top),S(t.right,e.right),S(t.bottom,e.bottom),S(t.left,e.left));else{var s=F(t);i=at(s,s,s,s)}return i||e}function at(t,e,n,i){return{top:t,right:e,bottom:n,left:i}}function ut(t,e){return{width:S(t.width,h),height:S(t.height,h),padding:ot(t.padding,e||p)}}function ct(t){return t.direction=1,(function(t){return function(e,n){return new st(e,n,t)}})(t)}!(function(t){t[t.Width=1]='Width',t[t.Height=2]='Height',t[t.All=3]='All',t[t.Count=4]='Count'})(K||(K={})),(function(t){t[t.RecalculateFromChildren=4]='RecalculateFromChildren'})(Q||(Q={}));var st=(function(t){function n(e,n,i){var o=t.call(this,e,i)||this;o.parse=ut,o._direction=i.direction||0,o._spacing=W(i.spacing)||d;for(var a=$(i),u=r(i)?i:i.content,c=u.length,l=Array(c),h=0;h<c;h++){var f=u[h];l[h]=f(o,n)}return o._flags=4|a,o._children=l,n.on(s,(function(){var t=o._flags;if(4&t){o._flags&=-5;var e=o._children,n=e.filter((function(t){return!t.skip}));(function(t,e,n,i,r){et(t,e,(function(t){return(function(t,e,n,i){var r,o,a=n===i,u=0;if(a&&!V(e))return null;for(var c=T[i],s=P[i],l=R[i],d=-1,h=0,f=t;h<f.length;h++){var p=f[h],v=p.position,g=v[c],_=v.padding,m=_[s],w=_[l];if(!it(g,m,w))return null;p.skip||(r=u,o=g[0]+m[0]+w[0],u=a?r+o:r<o?o:r,d++)}return a&&(u+=e[0]*d),u})(n,i,r,t)}))})(o.position,t,e,o._spacing,o._direction),o._renderableChildren=n,o._renderableChildrenPositions=n.map((function(t){return t.position}))}})),o}return e(n,t),n.prototype.recalculate=function(){this._flags|=4,3&this._flags&&this._parent.recalculate()},n.prototype.layout=function(t,e){var n=this;!(function(t,e,n,i,r){var o=t.length;if(o)for(var a=1==n?0:1,u=(function(t,e,n,i){var r=t.length,o={_elements:Array(r),_requestedPixels:0,_requestedPercentile:0,_requestedWeightTotal:0};rt(e,o,r-1);for(var a=0;a<r;a++){var u=t[a],c=u.padding,s={_mainSize:u[T[n]],_otherSize:u[T[i]],_padding:c};o._elements[a]=s;var l=s._mainSize,d=s._padding[P[n]],h=s._padding[R[n]];rt(l,o),rt(d,o),rt(h,o)}return o})(t,i,n,a),c=e[T[n]]-u._requestedPixels,s=u._requestedWeightTotal,l=u._requestedPercentile,d=I(i,c,s,l),h=0,f=0;f<o;f++){var p=u._elements[f],v=h+e[O[n]],g=I(p._mainSize,c,s,l),_=p._padding,m={};m[O[n]]=v,m[T[n]]=g,m[O[a]]=e[O[a]],m[T[a]]=e[T[a]],h+=E(m,n,_,c,s,l),G(m,a,p._otherSize,_),r(f,m),h+=d}})(this._renderableChildrenPositions,e,this._direction,this._spacing,(function(e,i){n._renderableChildren[e].layout(t,i)}))},n})(Y),lt=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._bind=function(t){var e=t._activeWidgets;e&&this._refresh(e),this._source=t},n.prototype._createBinding=function(t,e,n){var i=this,r=t.name||(t.name=_());return new w(r,e,n,(function(t){var e=i._source;if(e&&e.isOpen()){var o=e.getWidget(r);o&&n(o,t)}}))},n.prototype._refresh=function(t){var e=this._bindings;if(e)for(var n=0,i=e;n<i.length;n++){var r=i[n];r._callback(t[r._id],r._store.get())}},n})(b);function dt(t,e){for(var n=0,i=t.length;n<i;n++)t[n](e)}var ht=(function(){function t(t,e,n,i,r,o,a){this.width=t,this.height=e,this._parent=n,this._open=i,this._update=r,this._redraw=o,this._close=a,this.recalculate=this.redraw}return t.prototype.layout=function(t,e){dt(this._redraw,this);var n=this._body,i=n.position,r=ft(t,this.width,i,1),o=ft(t,this.height,i,0);return n.layout(e,t),{width:r,height:o}},t.prototype.redraw=function(){this._activeWidgets&&this._parent.redraw()},t.prototype.parse=function(t){return{width:h,height:h,_padding:ot(t.padding)}},t.prototype.getWidget=function(t){var e,n=this._activeWidgets;return n&&(e=n[t]),e||null},t.prototype.isOpen=function(){return!!this._activeWidgets},t.prototype.open=function(t,e){U(t,1,this.width),U(t,0,this.height),this._activeWidgets=e;var n=this._binder;n&&n._bind(this),dt(this._open,this)},t.prototype.update=function(){dt(this._update,this)},t.prototype.close=function(){dt(this._close,this);var t=this._binder;t&&t._unbind(),this._activeWidgets=void 0},t})();function ft(t,e,n,i){var r=T[i],o=t[r],a=n[r],u=n._padding,c=e==j;return c&&o==D||e==D?(V(a)||M('Window body '+r+' must resolve to absolute size for "auto" window size.'),a[0]+(function(t,e,n){var i=e[P[n]],r=e[R[n]];return V(i)&&V(r)||M('Window padding must be absolute for "auto" window size.'),t[O[n]]+=i[0],i[0]+r[0]})(t,u,i)):(G(t,i,a,u),c?o:a[0])}var pt=(function(){function t(t,e,n,i,r,o,a){void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===o&&(o=[]),void 0===a&&(a=[]),this.open=i,this.update=r,this.redraw=o,this.close=a,this._widgets=[];var u=new ht(n.width||j,n.height||j,t,i,r,o,a),c=new lt,s=e.onOpen,l=e.onUpdate,d=e.onClose;this.binder=c,this.context=u,u._body=new st(u,this,n),u._binder=c._hasBindings()?c:null,s&&i.push(s),l&&r.push(l),d&&a.push(d)}return t.prototype.add=function(t){this._widgets.push(t)},t.prototype.on=function(t,e){this[t].push(e)},t})();function vt(t){return n(t.padding)&&(t.padding=l),new gt(t)}var gt=(function(t){function n(e){var n=t.call(this,e)||this,i=new pt(n,e,e),r=i._widgets;return n._description.widgets=r,n._descriptionWidgetMap=k(r),n._frame=i.context,n}return e(n,t),n.prototype._invoke=function(t){t(this._frame)},n.prototype._layout=function(t,e){var n=this._createFrameRectangle(this._flags),i=this._frame.layout(n,e);this._setAutoWindowSize(t,i,15)},n})(X),_t=(function(){function t(t){this._value=t}return t.prototype.get=function(){return this._value},t.prototype.subscribe=function(t){this._listeners?this._listeners.push(t):this._listeners=[t];var e=this._listeners;return function(){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.prototype._updateListeners=function(t){this._listeners&&dt(this._listeners,t)},t})(),mt=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.set=function(t){this._value!==t&&(this._value=t,this._updateListeners(t))},n})(_t);function wt(t){return new mt(t)}function yt(t){return y(t)?t.get():t}var xt=Array.prototype.slice;function bt(){for(var t=arguments,e=xt.call(t,0,-1),n=e.length,i=t[n],r=wt(Ct(e,i)),o=0;o<n;)m(e[o++],(function(){var t=Ct(e,i);return r.set(t)}));return r}function Ct(t,e){var n=t.map((function(t){return t.get()}));return e.apply(void 0,n)}function kt(t,e){y(t)?(m(t,e),e(t.get())):n(t)||e(t)}function Vt(t,e,n){return t<e?t=e:t>n&&(t=n),t}function At(t,e,n){return t<e?t=n:t>n&&(t=e),t}var Lt=Math.round;function zt(t,e,n){var i=t[e];i.x=Lt(n.x),i.y=Lt(n.y),i.width=Lt(n.width-.1),i.height=Lt(n.height-.1)}var Mt,Wt=(function(t){function n(e,n,i,r){var o=t.call(this,n,r)||this;o.name=_(),o.x=0,o.y=0,o.width=0,o.height=0,o.type=e;var a=i.binder,u=i.context,c=r.visibility;return a.add(o,'tooltip',r.tooltip),a.add(o,'isDisabled',r.disabled),a.add(o,'isVisible',c,(function(t){return'visible'===t})),kt(c,(function(t){var e=o.skip,i='none'===t;o.skip=i,(e||i)&&(n.recalculate(),u.redraw())})),i.add(o),o}return e(n,t),n.prototype.layout=function(t,e){zt(t,this.name,e)},n})(Y);!(function(t){t[t.RecalculateFromChildren=4]='RecalculateFromChildren',t[t.AddTitlePadding=8]='AddTitlePadding'})(Mt||(Mt={}));var St=(function(t){function n(e,n,i){var r,o=this,a='groupbox',u='content',c=$(i);if(u in i){o=t.call(this,a,e,n,i)||this,r=i[u];var l=n.binder,d=i.text;l.add(o,'text',d),c|=d?8:0}else o=t.call(this,a,e,n,{})||this,r=i;o._flags=4|c;var h=r(o,n);return o._child=h,n.on(s,(function(){4&o._flags&&(o._flags&=-5,(function(t,e,n){et(t,e,(function(t){return(function(t,e){var n=t[T[e]],i=t.padding,r=i[P[e]],o=i[R[e]];return it(n,r,o)?n[0]+r[0]+o[0]:null})(n,t)}))})(o.position,o._flags,o._child.position))})),o}return e(n,t),n.prototype.parse=function(t){var e=ot(6);return 8&this._flags&&(e.top=[15,0]),ut(t,e)},n.prototype.recalculate=function(){this._flags|=4,3&this._flags&&this._parent.recalculate()},n.prototype.layout=function(e,n){var i=8&this._flags?0:4;n.y-=i,n.height+=i,t.prototype.layout.call(this,e,n),n.y+=i,n.height-=i;var r=this._child,o=r.position;(function(t,e,n,i){G(t,1,e,i),G(t,0,n,i)})(n,o.width,o.height,o.padding),r.layout(e,n)},n})(Wt);function Ft(t){return function(e,n){return new It(e,n,t)}}var It=(function(t){function n(e,n,i){var r=t.call(this,'button',e,n,i)||this,o=n.binder;return o.add(r,'text',i.text),o.add(r,'image',i.image),o.add(r,'border',i.border),o.add(r,'isPressed',i.isPressed),r.onClick=i.onClick,r}return e(n,t),n})(Wt);function Ot(t,e,n){return e?function(i){t._silenceOnChange||(n?n(i,e):e(i))}:e}function Tt(t){return n(t.width)&&(t.width=12),n(t.height)&&(t.height=12),function(e,n){return new Pt(e,n,t)}}var Pt=(function(t){function n(e,n,i){var r=t.call(this,'colourpicker',e,n,i)||this,o=i.colour,a=n.binder;return a.on(r,o,(function(t,e){!(function(t,e,n,i){t._silenceOnChange=!0,e.colour=i,t._silenceOnChange=!1})(r,t,0,e)})),a.callback(r,'onChange',o,Ot(r,i.onChange)),r}return e(n,t),n.prototype.layout=function(e,n){n.y+=1,t.prototype.layout.call(this,e,n)},n})(Wt);function Rt(t){return v(t),function(e,n){return new Gt(e,n,t)}}var Gt=(function(t){function n(e,n,i){var r=t.call(this,'dropdown',e,n,i)||this;r.items=[],r.selectedIndex=0;var o=i.items,a=i.disabled,u=i.disabledMessage,c=i.onChange,s=(function(t){switch(t){case'empty':return 0;case'single':return 1}return-1})(i.autoDisable),l=i.selectedIndex,d=function(t){r._updateDropdown(t,yt(o),yt(a),s,u)},h=n.binder,f=d;y(o)&&(f=function(t,e){d(t),r._setNewSelectedIndexOfSameSelectedItem(t,e),r._previousItems=e}),h.on(r,o,f),h.on(r,l,(function(t,e){r._selectedIndex=e,d(t)})),h.on(r,a,d);var p=Ot(r,c,(function(t,e){return e(t<0?0:t)}));return h.callback(r,'onChange',l,p),r}return e(n,t),n.prototype._updateDropdown=function(t,e,n,i,r){this._silenceOnChange=!0;var o=n||!e||e.length<=i;o&&r?t.items=[r]:(t.items=e,t.selectedIndex=this._selectedIndex||0),t.isDisabled=o,this._silenceOnChange=!1},n.prototype._setNewSelectedIndexOfSameSelectedItem=function(t,e){var n=this._previousItems;if(n){var i=n[t.selectedIndex||0],r=e.indexOf(i);r<0&&(r=0),this._selectedIndex!==r&&(this._selectedIndex=r,t.selectedIndex=r)}},n})(Wt);function Et(t){return v(t),function(e,n){return new qt(e,n,t)}}var qt=(function(t){function n(e,n,i){var r=t.call(this,'spinner',e,n,i)||this;r._step=1,r._minimum=-2147483648,r._maximum=2147483647;var o=i.value,a=x(o)?o.twoway:(function(t){if(y(t)){var e=wt(t.get());return m(t,(function(t){return e.set(t)})),e}return wt(t)})(o||0),u=i.format||function(t){return t.toString()},c=n.binder,s=i.disabledMessage,l=i.minimum,d=i.maximum;if(s){var h=i.disabled;c.add(r,'text',h,(function(t){return t?s:u(a.get())}));var f=u;u=function(t){return yt(h)?s:f(t)}}return r._value=a,c.add(r,'text',a,u),kt(i.step,(function(t){return r._step=t})),kt(l,(function(t){var e=a.get();r._minimum=t,e<t&&r._updateValueAndTriggerChange(t,t-e)})),kt(d,(function(t){var e=a.get();r._maximum=t,e>t&&r._updateValueAndTriggerChange(t,t-e)})),r._wrapMode=i.wrapMode||'clamp',r._onChange=i.onChange,r.onIncrement=function(){return r._onUserInput(1)},r.onDecrement=function(){return r._onUserInput(-1)},r._minimum>r._maximum&&M('Spinner: minimum '+r._minimum+' is larger than maximum '+r._maximum),r}return e(n,t),n.prototype._onUserInput=function(t){var e=this._minimum,n=this._maximum;if(!(e>=n)){var i,r=this._step*t,o=this._value.get(),a=o+r;switch(this._wrapMode){case'wrap':i=At(a,e,n);break;case'clampThenWrap':i=a<e&&o===e||a>n&&o===n?At(a,e,n):Vt(a,e,n);break;default:i=Vt(a,e,n)}this._updateValueAndTriggerChange(i,r)}},n.prototype._updateValueAndTriggerChange=function(t,e){this._value.set(t),this._onChange&&this._onChange(t,e)},n})(Wt);function Bt(t){var e,i,r,o=0;if('content'in t){e=t.content,i=t.gap,r=t.spacing;var a=t.direction;n(a)||(o=a)}else e=t;var u=t,c={content:e,direction:o,spacing:r,padding:i};return u.content=function(t,e){return new st(t,e,c)},function(t,e){return new St(t,e,u)}}function jt(t){return v(t),function(e,n){return new Dt(e,n,t)}}var Dt=(function(t){function n(e,n,i){var r=t.call(this,'label',e,n,i)||this;r.text='';var o=n.binder;return o.add(r,'text',i.text),o.add(r,'textAlign',i.alignment),r}return e(n,t),n.prototype.layout=function(e,n){n.y+=2,t.prototype.layout.call(this,e,n)},n})(Wt),Ht={x:-9e3,y:-9e3};function Nt(t){return function(e,n){return new Ut(e,n,t)}}var Ut=(function(t){function r(e,n,i){var r=t.call(this,'viewport',e,n,i)||this,o=n.binder,u=i.target,c=i.visibilityFlags,s=i.disabled,l=i.zoom,d=function(t){r._updateViewport(t.viewport,u,c,s)};return o.on(r,c,d),o.on(r,s,d),o.on(r,u,d),o.on(r,l,(function(t,e){var n=t.viewport;n&&(n.zoom=e)})),n.on('open',(function(t){var e=r._getViewportFromContext(t);e&&l&&(e.zoom=yt(l)),r._updateViewport(e,u,c,s)})),(y(u)||a(u))&&n.on('update',(function(t){var e=r._getViewportFromContext(t);r._updateViewport(e,u,c,s)})),r}return e(r,t),r.prototype._updateViewport=function(t,e,n,i){if(t){var r=this._getTargetLocation(yt(e)),o=yt(n),a=yt(i);this._setViewportLocation(t,r,o,a)}},r.prototype._getTargetLocation=function(t){var e=null;if(!(function(t){return n(t)||i(t)})(t))if(a(t)){var r=map.getEntity(t);r&&(e={x:r.x,y:r.y,z:r.z})}else u(t)&&(e=t);return e},r.prototype._setViewportLocation=function(t,e,n,i){!i&&e||(n=531707918,e=Ht),t.moveTo(e),t.visibilityFlags=n||0},r.prototype._getViewportFromContext=function(t){var e=t.getWidget(this.name);return e?e.viewport:null},r})(Wt);function Zt(t){for(var e=[],n=0;n<map.size.y;n++)for(var i=0;i<map.size.x;i++)for(var r=map.getTile(i,n),o=0;o<r.numElements;o++){var a=r.getElement(o);'track'===a.type&&a.ride===t.id&&e.push({position:{x:32*i,y:32*n,z:a.baseZ},element:a})}return e}function Jt(t){return''.concat(t.x,',').concat(t.y,',').concat(t.z)}var Kt,Qt={};function Xt(t){var e=Zt(t).reduce((function(t,e){var n=e.position,i=e.element;return t[Jt(n)]=i.colourScheme,t}),{});Qt[t.id]={colorSchemes:t.colourSchemes,elementColourSchemes:e}}function Yt(t){var e=Qt[t.id];if(e){Qt[t.id]=null;for(var n=0;n<e.colorSchemes.length;n++){var i=e.colorSchemes[n];context.executeAction('ridesetappearance',{ride:t.id,index:n,type:0,value:i.main}),context.executeAction('ridesetappearance',{ride:t.id,index:n,type:1,value:i.additional}),context.executeAction('ridesetappearance',{ride:t.id,index:n,type:2,value:i.supports})}Zt(t).forEach((function(t){var n=t.element,i=t.position;return n.colourScheme=e.elementColourSchemes[Jt(i)]}))}}function $t(t){return'ride'===t.classification&&255===t.object.carsPerFlatRide}!(function(t){t.All='All forces',t.Vertical='Vertical Gs',t.Lateral='Lateral Gs'})(Kt||(Kt={}));var te=function(){return te=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},te.apply(this,arguments)};function ee(t){var e=context.subscribe('interval.tick',(function(){t(),e.dispose()}))}function ne(){var t=map.rides.filter($t),e=t.length>0?t[0]:null,n=[Kt.All,Kt.Vertical,Kt.Lateral],i={selectedRide:wt(e),visualisationMode:wt(Kt.All),colours:{low:14,moderate:18,excessive:28},thresholds:{moderate:{lateral:140,positiveVertical:250,negativeVertical:-100},excessive:{lateral:280,positiveVertical:500,negativeVertical:-200}}};i.selectedRide.subscribe((function(t){null!=t&&Xt(t)}));var r=vt({title:'Force visualiser',width:280,height:280,content:[jt({text:'Select a tracked ride'}),Rt({items:t.map((function(t){return t.name})),selectedIndex:0,onChange:function(e){var n=i.selectedRide.get();null!=n&&Yt(n),i.selectedRide.set(t[e])}}),Rt({items:n,selectedIndex:0,onChange:function(t){i.visualisationMode.set(n[t])}}),Bt({text:'Colours',direction:1,content:[Tt({onChange:function(t){i.colours.low=t},colour:i.colours.low}),jt({text:'Low'}),Tt({onChange:function(t){i.colours.moderate=t},colour:i.colours.moderate}),jt({text:'Moderate'}),Tt({onChange:function(t){i.colours.excessive=t},colour:i.colours.excessive}),jt({text:'Excessive'})]}),Bt({text:'Moderate force thresholds',content:[ct([jt({text:'+/- Lateral',disabled:bt(i.visualisationMode,(function(t){return t===Kt.Vertical}))}),jt({text:'+ Vertical',disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))}),jt({text:'- Vertical',disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))})]),ct([Et({onChange:function(t){i.thresholds.moderate.lateral=t},value:i.thresholds.moderate.lateral,step:10,minimum:0,maximum:1e3,format:function(t){return(t/100).toFixed(1)+'G'},disabled:bt(i.visualisationMode,(function(t){return t===Kt.Vertical}))}),Et({onChange:function(t){i.thresholds.moderate.positiveVertical=t},value:i.thresholds.moderate.positiveVertical,step:10,minimum:0,maximum:1e3,format:function(t){return(t/100).toFixed(1)+'G'},disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))}),Et({onChange:function(t){i.thresholds.moderate.negativeVertical=t},value:i.thresholds.moderate.negativeVertical,step:10,minimum:-1e3,maximum:0,format:function(t){return(t/100).toFixed(1)+'G'},disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))})])]}),Bt({text:'Excessive force thresholds',content:[ct([jt({text:'+/- Lateral',disabled:bt(i.visualisationMode,(function(t){return t===Kt.Vertical}))}),jt({text:'+ Vertical',disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))}),jt({text:'- Vertical',disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))})]),ct([Et({onChange:function(t){i.thresholds.excessive.lateral=t},value:i.thresholds.excessive.lateral,step:10,minimum:0,maximum:1e3,format:function(t){return(t/100).toFixed(1)+'G'},disabled:bt(i.visualisationMode,(function(t){return t===Kt.Vertical}))}),Et({onChange:function(t){i.thresholds.excessive.positiveVertical=t},value:i.thresholds.excessive.positiveVertical,step:10,minimum:0,maximum:1e3,format:function(t){return(t/100).toFixed(1)+'G'},disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))}),Et({onChange:function(t){i.thresholds.excessive.negativeVertical=t},value:i.thresholds.excessive.negativeVertical,step:10,minimum:-1e3,maximum:0,format:function(t){return(t/100).toFixed(1)+'G'},disabled:bt(i.visualisationMode,(function(t){return t===Kt.Lateral}))})])]}),Ft({text:'Visualise forces',onClick:function(){r.close(),ee((function(){return t=i.selectedRide.get(),e=i.colours,n=i.thresholds,r=i.visualisationMode.get(),a=(function(t,e,n,i){Xt(t),(function(t,e){for(var n=[1,e.low,e.moderate,e.excessive],i=0;i<4;i++)context.executeAction('ridesetappearance',{ride:t.id,index:i,type:0,value:n[i]}),context.executeAction('ridesetappearance',{ride:t.id,index:i,type:1,value:n[i]}),context.executeAction('ridesetappearance',{ride:t.id,index:i,type:2,value:54})})(t,e),(function(t){Zt(t).forEach((function(t){return t.element.colourScheme=0}))})(t);var r={},o=map.getAllEntities('car').filter((function(e){return e.id&&-1!==t.vehicles.indexOf(e.id)})),a=context.subscribe('interval.tick',(function(){o.forEach((function(t){var e=(function(t,e,n){var i=n===Kt.All||n===Kt.Lateral,r=n===Kt.All||n===Kt.Vertical,o=1;return i&&(t.lateralG>e.moderate.lateral||t.lateralG<-e.moderate.lateral)&&(o=2),r&&(t.verticalG>e.moderate.positiveVertical||t.verticalG<e.moderate.negativeVertical)&&(o=2),i&&(t.lateralG>e.excessive.lateral||t.lateralG<-e.excessive.lateral)&&(o=3),r&&(t.verticalG>e.excessive.positiveVertical||t.verticalG<e.excessive.negativeVertical)&&(o=3),o})(t.gForces,n,i),o=Jt(t.trackLocation),a=r[o];if(null!=a){if(a>e?e=a:a<e&&(r[o]=e),a===e)return}else r[o]=e;var u,c,s,l=(u=map.getTile(t.trackLocation.x/32,t.trackLocation.y/32),c=t.trackLocation.z,(s=u.elements.map((function(t,e){return{element:t,index:e}})).filter((function(t){return'track'===t.element.type&&t.element.baseZ===c}))).length>0?s[s.length-1].index:-1),d=map.getTrackIterator(t.trackLocation,l);if(!d)throw Error('Could not find track iterator at x: '.concat(t.trackLocation.x,', y: ').concat(t.trackLocation.y,', z: ').concat(t.trackLocation.z,', d: ').concat(t.trackLocation.direction));if(!d.segment)throw Error('Could not find track segment at x: '.concat(t.trackLocation.x,', y: ').concat(t.trackLocation.y,', z: ').concat(t.trackLocation.z,', d: ').concat(t.trackLocation.direction));var h=d.segment.elements.map((function(t){return(function(t,e){var n;switch(t.direction){case 0:n=te({},e);break;case 1:n={x:e.y,y:-e.x};break;case 2:n={x:-e.x,y:-e.y};break;case 3:n={x:-e.y,y:e.x}}return{x:t.x+n.x,y:t.y+n.y,z:t.z+e.z}})(d.position,t)})).map((function(t){return e=t,map.getTile(e.x/32,e.y/32).elements.filter((function(t){return t.baseZ===e.z&&'track'===t.type}));var e})).reduce((function(t,e){return t.concat(e)}),[]);h.forEach((function(t){return t.colourScheme=e}))}))}));return{dispose:function(){a.dispose(),Yt(t)}}})(t,e,n,r),void vt({title:'Force visualiser',width:280,height:210,content:[jt({text:'Visualising '.concat((o=r,o.charAt(0).toLowerCase()+o.slice(1)),' for ').concat(t.name)}),Nt({target:t.vehicles[0]})],onClose:function(){a.dispose(),ee((function(){return ne()}))}}).open();var t,e,n,r,o,a}))},disabled:bt(i.selectedRide,(function(t){return null==t}))})]});r.open()}registerPlugin({name:'Force visualiser',version:'1.0',authors:['Alfie Woodland'],type:'local',licence:'MIT',targetApiVersion:77,minApiVersion:77,main:function(){ui.registerMenuItem('Force visualiser',ne)}})})();